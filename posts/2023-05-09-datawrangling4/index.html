<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { color: #00769e; background-color: #f1f3f5; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span { color: #00769e; } /* Normal */
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { color: #657422; } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #00769e; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #00769e; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #00769e; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
<title>yuzaR-Blog: {dplyr} on Steroids: Handling Data Bases</title>

<meta property="description" itemprop="description" content="If you know how to tidy up data within one table, you&#39;re already a skilled data scientist! However, as data continues to grow exponentially, taking your skills to the next level involves mastering the art of working with multiple tables within a database, typically done using SQL. In this post, we&#39;ll learn three essential techniques using {dplyr} that will allow you to handle databases with ease: merging multiple tables, reducing redundancy through table joins, and effortlessly modifying values within the resulting table."/>

<link rel="canonical" href="https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/"/>
<link rel="license" href="https://creativecommons.org/licenses/by/4.0/"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2023-07-14"/>
<meta property="article:created" itemprop="dateCreated" content="2023-07-14"/>
<meta name="article:author" content="Yury Zablotski"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="yuzaR-Blog: {dplyr} on Steroids: Handling Data Bases"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="If you know how to tidy up data within one table, you&#39;re already a skilled data scientist! However, as data continues to grow exponentially, taking your skills to the next level involves mastering the art of working with multiple tables within a database, typically done using SQL. In this post, we&#39;ll learn three essential techniques using {dplyr} that will allow you to handle databases with ease: merging multiple tables, reducing redundancy through table joins, and effortlessly modifying values within the resulting table."/>
<meta property="og:url" content="https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/"/>
<meta property="og:image" content="https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/dplyr_4_thumbnail.png"/>
<meta property="og:image:width" content="1920"/>
<meta property="og:image:height" content="1080"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="yuzaR-Blog"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary_large_image"/>
<meta property="twitter:title" content="yuzaR-Blog: {dplyr} on Steroids: Handling Data Bases"/>
<meta property="twitter:description" content="If you know how to tidy up data within one table, you&#39;re already a skilled data scientist! However, as data continues to grow exponentially, taking your skills to the next level involves mastering the art of working with multiple tables within a database, typically done using SQL. In this post, we&#39;ll learn three essential techniques using {dplyr} that will allow you to handle databases with ease: merging multiple tables, reducing redundancy through table joins, and effortlessly modifying values within the resulting table."/>
<meta property="twitter:url" content="https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/"/>
<meta property="twitter:image" content="https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/dplyr_4_thumbnail.png"/>
<meta property="twitter:image:width" content="1920"/>
<meta property="twitter:image:height" content="1080"/>
<meta property="twitter:site" content="@yuzaR___"/>

<!--  https://scholar.google.com/intl/en/scholar/inclusion.html#indexing -->
<meta name="citation_title" content="yuzaR-Blog: {dplyr} on Steroids: Handling Data Bases"/>
<meta name="citation_fulltext_html_url" content="https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/"/>
<meta name="citation_fulltext_world_readable" content=""/>
<meta name="citation_online_date" content="2023/07/14"/>
<meta name="citation_publication_date" content="2023/07/14"/>
<meta name="citation_author" content="Yury Zablotski"/>
<!--/radix_placeholder_meta_tags-->
  
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["creative_commons","title","description","author","date","categories","preview","output","bibliography","biblio-style","link-citations","linkcolor","citation_url","canonical_url"]}},"value":[{"type":"character","attributes":{},"value":["CC BY"]},{"type":"character","attributes":{},"value":["{dplyr} on Steroids: Handling Data Bases"]},{"type":"character","attributes":{},"value":["If you know how to tidy up data within one table, you're already a skilled data scientist! However, as data continues to grow exponentially, taking your skills to the next level involves mastering the art of working with multiple tables within a database, typically done using SQL. In this post, we'll learn three essential techniques using {dplyr} that will allow you to handle databases with ease: merging multiple tables, reducing redundancy through table joins, and effortlessly modifying values within the resulting table."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name","url"]}},"value":[{"type":"character","attributes":{},"value":["Yury Zablotski"]},{"type":"character","attributes":{},"value":["https://yuzar-blog.netlify.app/"]}]}]},{"type":"character","attributes":{},"value":["July 14, 2023"]},{"type":"character","attributes":{},"value":["videos","statistics","data wrangling","R package reviews"]},{"type":"character","attributes":{},"value":["dplyr_4_thumbnail.png"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","toc","toc_float","toc_depth","code_download"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]},{"type":"integer","attributes":{},"value":[6]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"character","attributes":{},"value":["/Users/zablotski/Documents/library.bib"]},{"type":"character","attributes":{},"value":["apalike"]},{"type":"logical","attributes":{},"value":[true]},{"type":"character","attributes":{},"value":["blue"]},{"type":"character","attributes":{},"value":["https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/"]},{"type":"character","attributes":{},"value":["https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/"]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["anti_join_rev.png","anti_join.png","anti-join.gif","case_when-allison.jpeg","combine tables3.png","combine_table1.png","combine_table2.png","datawrangling4_files/anchor-4.2.2/anchor.min 2.js","datawrangling4_files/anchor-4.2.2/anchor.min.js","datawrangling4_files/bowser-1.9.3/bowser.min 2.js","datawrangling4_files/bowser-1.9.3/bowser.min.js","datawrangling4_files/distill-2.2.21/template.v2.js","datawrangling4_files/figure-html5/unnamed-chunk-10-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-11-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-11-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-12-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-13-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-13-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-14-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-14-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-15-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-15-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-16-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-17-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-17-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-18-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-19-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-2-1.png","datawrangling4_files/figure-html5/unnamed-chunk-20-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-21-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-21-1.png","datawrangling4_files/figure-html5/unnamed-chunk-22-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-22-1.png","datawrangling4_files/figure-html5/unnamed-chunk-22-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-23-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-23-1.png","datawrangling4_files/figure-html5/unnamed-chunk-24-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-24-1.png","datawrangling4_files/figure-html5/unnamed-chunk-24-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-25-1.png","datawrangling4_files/figure-html5/unnamed-chunk-26-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-26-1.png","datawrangling4_files/figure-html5/unnamed-chunk-26-2.gif","datawrangling4_files/figure-html5/unnamed-chunk-26-2.png","datawrangling4_files/figure-html5/unnamed-chunk-27-1.png","datawrangling4_files/figure-html5/unnamed-chunk-27-2.png","datawrangling4_files/figure-html5/unnamed-chunk-28-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-28-1.png","datawrangling4_files/figure-html5/unnamed-chunk-29-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-3-1 2.png","datawrangling4_files/figure-html5/unnamed-chunk-3-1.png","datawrangling4_files/figure-html5/unnamed-chunk-30-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-30-1.png","datawrangling4_files/figure-html5/unnamed-chunk-31-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-32-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-33-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-34-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-35-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-36-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-37-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-4-1.png","datawrangling4_files/figure-html5/unnamed-chunk-5-1.png","datawrangling4_files/figure-html5/unnamed-chunk-6-1.png","datawrangling4_files/figure-html5/unnamed-chunk-7-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-7-1.png","datawrangling4_files/figure-html5/unnamed-chunk-8-1.gif","datawrangling4_files/figure-html5/unnamed-chunk-9-1.gif","datawrangling4_files/header-attrs-2.21/header-attrs 2.js","datawrangling4_files/header-attrs-2.21/header-attrs.js","datawrangling4_files/header-attrs-2.23/header-attrs.js","datawrangling4_files/jquery-3.6.0/jquery-3.6.0.js","datawrangling4_files/jquery-3.6.0/jquery-3.6.0.min 2.js","datawrangling4_files/jquery-3.6.0/jquery-3.6.0.min.js","datawrangling4_files/jquery-3.6.0/jquery-3.6.0.min.map","datawrangling4_files/popper-2.6.0/popper.min 2.js","datawrangling4_files/popper-2.6.0/popper.min.js","datawrangling4_files/tippy-6.2.7/tippy 2.css","datawrangling4_files/tippy-6.2.7/tippy-bundle.umd.min 2.js","datawrangling4_files/tippy-6.2.7/tippy-bundle.umd.min.js","datawrangling4_files/tippy-6.2.7/tippy-light-border 2.css","datawrangling4_files/tippy-6.2.7/tippy-light-border.css","datawrangling4_files/tippy-6.2.7/tippy.css","datawrangling4_files/tippy-6.2.7/tippy.umd.min 2.js","datawrangling4_files/tippy-6.2.7/tippy.umd.min.js","datawrangling4_files/vembedr-0.1.5/css/vembedr 2.css","datawrangling4_files/vembedr-0.1.5/css/vembedr.css","datawrangling4_files/webcomponents-2.0.0/webcomponents 2.js","datawrangling4_files/webcomponents-2.0.0/webcomponents.js","DEDA.png","dplyr_4_thumbnail.png","full-join.gif","inner-join.gif","intersect.gif","join-many-to-many.png","join-outer.png","join-semi-many.png","join-venn.png","left-join-extra.gif","left-join.gif","report_files/figure-html/correlation_analysis-1.png","report_files/figure-html/missing_profile-1.png","report_files/figure-html/plot_frequency_bar-1.png","report_files/figure-html/plot_histogram-1.png","report_files/figure-html/plot_intro-1.png","report_files/figure-html/plot_normal_qq-1.png","report_files/figure-html/plot_response_boxplot-1.png","report_files/figure-html/plot_response_qq-1.png","report_files/figure-html/plot_response_scatterplot-1.png","report_files/figure-html/principal_component_analysis-1.png","report_files/figure-html/principal_component_analysis-2.png","report.html","right-join.gif","semi_join_rev.png","semi_join.png","semi-join.gif","setdiff-rev.gif","setdiff.gif","sql_logo.avif","sql_logo.png","SQL-Server-Sample-Database.png","thumbnails_for_3_videos/combine_tables.png","thumbnails_for_3_videos/IF_ELSE_CASE_WHEN.png","thumbnails_for_3_videos/join_tables.png","union-all.gif","union-rev.gif","union.gif"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<script src="../../site_libs/autocomplete-0.37.1/autocomplete.min.js"></script>
<script src="../../site_libs/fuse-6.4.1/fuse.min.js"></script>

<script type="application/javascript">

function getMeta(metaName) {
  var metas = document.getElementsByTagName('meta');
  for (let i = 0; i < metas.length; i++) {
    if (metas[i].getAttribute('name') === metaName) {
      return metas[i].getAttribute('content');
    }
  }
  return '';
}

function offsetURL(url) {
  var offset = getMeta('distill:offset');
  return offset ? offset + '/' + url : url;
}

function createFuseIndex() {

  // create fuse index
  var options = {
    keys: [
      { name: 'title', weight: 20 },
      { name: 'categories', weight: 15 },
      { name: 'description', weight: 10 },
      { name: 'contents', weight: 5 },
    ],
    ignoreLocation: true,
    threshold: 0
  };
  var fuse = new window.Fuse([], options);

  // fetch the main search.json
  return fetch(offsetURL('search.json'))
    .then(function(response) {
      if (response.status == 200) {
        return response.json().then(function(json) {
          // index main articles
          json.articles.forEach(function(article) {
            fuse.add(article);
          });
          // download collections and index their articles
          return Promise.all(json.collections.map(function(collection) {
            return fetch(offsetURL(collection)).then(function(response) {
              if (response.status === 200) {
                return response.json().then(function(articles) {
                  articles.forEach(function(article) {
                    fuse.add(article);
                  });
                })
              } else {
                return Promise.reject(
                  new Error('Unexpected status from search index request: ' +
                            response.status)
                );
              }
            });
          })).then(function() {
            return fuse;
          });
        });

      } else {
        return Promise.reject(
          new Error('Unexpected status from search index request: ' +
                      response.status)
        );
      }
    });
}

window.document.addEventListener("DOMContentLoaded", function (event) {

  // get search element (bail if we don't have one)
  var searchEl = window.document.getElementById('distill-search');
  if (!searchEl)
    return;

  createFuseIndex()
    .then(function(fuse) {

      // make search box visible
      searchEl.classList.remove('hidden');

      // initialize autocomplete
      var options = {
        autoselect: true,
        hint: false,
        minLength: 2,
      };
      window.autocomplete(searchEl, options, [{
        source: function(query, callback) {
          const searchOptions = {
            isCaseSensitive: false,
            shouldSort: true,
            minMatchCharLength: 2,
            limit: 10,
          };
          var results = fuse.search(query, searchOptions);
          callback(results
            .map(function(result) { return result.item; })
          );
        },
        templates: {
          suggestion: function(suggestion) {
            var img = suggestion.preview && Object.keys(suggestion.preview).length > 0
              ? `<img src="${offsetURL(suggestion.preview)}"</img>`
              : '';
            var html = `
              <div class="search-item">
                <h3>${suggestion.title}</h3>
                <div class="search-item-description">
                  ${suggestion.description || ''}
                </div>
                <div class="search-item-preview">
                  ${img}
                </div>
              </div>
            `;
            return html;
          }
        }
      }]).on('autocomplete:selected', function(event, suggestion) {
        window.location.href = offsetURL(suggestion.path);
      });
      // remove inline display style on autocompleter (we want to
      // manage responsive display via css)
      $('.algolia-autocomplete').css("display", "");
    })
    .catch(function(error) {
      console.log(error);
    });

});

</script>

<style type="text/css">

.nav-search {
  font-size: x-small;
}

/* Algolioa Autocomplete */

.algolia-autocomplete {
  display: inline-block;
  margin-left: 10px;
  vertical-align: sub;
  background-color: white;
  color: black;
  padding: 6px;
  padding-top: 8px;
  padding-bottom: 0;
  border-radius: 6px;
  border: 1px #0F2E3D solid;
  width: 180px;
}


@media screen and (max-width: 768px) {
  .distill-site-nav .algolia-autocomplete {
    display: none;
    visibility: hidden;
  }
  .distill-site-nav.responsive .algolia-autocomplete {
    display: inline-block;
    visibility: visible;
  }
  .distill-site-nav.responsive .algolia-autocomplete .aa-dropdown-menu {
    margin-left: 0;
    width: 400px;
    max-height: 400px;
  }
}

.algolia-autocomplete .aa-input, .algolia-autocomplete .aa-hint {
  width: 90%;
  outline: none;
  border: none;
}

.algolia-autocomplete .aa-hint {
  color: #999;
}
.algolia-autocomplete .aa-dropdown-menu {
  width: 550px;
  max-height: 70vh;
  overflow-x: visible;
  overflow-y: scroll;
  padding: 5px;
  margin-top: 3px;
  margin-left: -150px;
  background-color: #fff;
  border-radius: 5px;
  border: 1px solid #999;
  border-top: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion {
  cursor: pointer;
  padding: 5px 4px;
  border-bottom: 1px solid #eee;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion:last-of-type {
  border-bottom: none;
  margin-bottom: 2px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item {
  overflow: hidden;
  font-size: 0.8em;
  line-height: 1.4em;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item h3 {
  font-size: 1rem;
  margin-block-start: 0;
  margin-block-end: 5px;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-description {
  display: inline-block;
  overflow: hidden;
  height: 2.8em;
  width: 80%;
  margin-right: 4%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview {
  display: inline-block;
  width: 15%;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img {
  height: 3em;
  width: auto;
  display: none;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion .search-item-preview img[src] {
  display: initial;
}

.algolia-autocomplete .aa-dropdown-menu .aa-suggestion.aa-cursor {
  background-color: #eee;
}
.algolia-autocomplete .aa-dropdown-menu .aa-suggestion em {
  font-weight: bold;
  font-style: normal;
}

</style>


<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
  font-size: 100%;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

hr.section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 0px;
}


d-byline {
  border-top: none;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
  border-top: none;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

/* tweak for Pandoc numbered line within distill */
d-article pre.numberSource code > span {
    left: -2em;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // separator
  var separator = '<hr class="section-separator" style="clear: both"/>';
  // prepend separator above appendix
  $('.d-byline').before(separator);
  $('.d-article').before(separator);

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme, except when numbering line
  // in code chunk
  $('pre:not(.numberLines) code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      var author_name = front_matter.authors[i].author
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', author_name ? 'ORCID ID for ' + author_name : 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      const citeChild = $(this).children()[0]
      // Do not process if @xyz has been used without escaping and without bibliography activated
      // https://github.com/rstudio/distill/issues/466
      if (citeChild === undefined) return true

      if (citeChild.nodeName == "D-FOOTNOTE") {
        var fn = citeChild
        $(this).html(fn.shadowRoot.querySelector("sup"))
        $(this).id = fn.id
        fn.remove()
      }
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        // Could use CSS.escape too here, we insure backward compatibility in navigator
        return "<p>" + $('div[id="ref-' + ref + '"]').html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // fix footnotes in tables (#411)
    // replacing broken distill.pub feature
    $('table d-footnote').each(function() {
      // we replace internal showAtNode methode which is triggered when hovering a footnote
      this.hoverBox.showAtNode = function(node) {
        // ported from https://github.com/distillpub/template/pull/105/files
        calcOffset = function(elem) {
            let x = elem.offsetLeft;
            let y = elem.offsetTop;
            // Traverse upwards until an `absolute` element is found or `elem`
            // becomes null.
            while (elem = elem.offsetParent && elem.style.position != 'absolute') {
                x += elem.offsetLeft;
                y += elem.offsetTop;
            }

            return { left: x, top: y };
        }
        // https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/offsetTop
        const bbox = node.getBoundingClientRect();
        const offset = calcOffset(node);
        this.show([offset.left + bbox.width, offset.top + bbox.height]);
      }
    })

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    // ignore leaflet img layers (#106)
    figures = figures.filter(':not(img[class*="leaflet"])')
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace(/^index[.]html/, "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */



html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */
</style>
<style type="text/css">
/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */





html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     #000000;
  --header-color:    rgba(0, 0, 0, 0.8);
  --body-color:      rgba(0, 0, 0, 0.8);
  --aside-color:     rgba(0, 0, 0, 0.6);
  --fig-cap-color:   rgba(0, 0, 0, 0.6);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  --heading-size:    0.6rem;
  --heading-color:   rgba(0, 0, 0, 0.5);
  --body-size:       0.8rem;
  --body-color:      rgba(0, 0, 0, 0.8);
}

/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgba(0, 0, 0, 0.65);
  --text-size:       0.8em;
  --text-color:      rgba(0, 0, 0, 0.5);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       25px;
  --text-color:       white;
  --text-size:        25px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
  font-weight: bold;
}

.distill-site-footer {
  --text-color:       rgba(255, 255, 255, 0.8);
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #0F2E3D;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

</style>
<style type="text/css">
/* base style */

/* FONT FAMILIES */

:root {
  --heading-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  --mono-default: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  --body-default: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

body,
.posts-list .post-preview p,
.posts-list .description p {
  font-family: var(--body-font), var(--body-default);
}

h1, h2, h3, h4, h5, h6,
.posts-list .post-preview h2,
.posts-list .description h2 {
  font-family: var(--heading-font), var(--heading-default);
}

d-article div.sourceCode code,
d-article pre code {
  font-family: var(--mono-font), var(--mono-default);
}


/*-- TITLE --*/
d-title h1,
.posts-list > h1 {
  color: var(--title-color, black);
}

d-title h1 {
  font-size: var(--title-size, 50px);
}

/*-- HEADERS --*/
d-article h1,
d-article h2,
d-article h3,
d-article h4,
d-article h5,
d-article h6 {
  color: var(--header-color, rgba(0, 0, 0, 0.8));
}

/*-- BODY --*/
d-article > p,  /* only text inside of <p> tags */
d-article > ul, /* lists */
d-article > ol {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
  font-size: var(--body-size, 1.06rem);
}


/*-- CODE --*/
d-article div.sourceCode code,
d-article pre code {
  font-size: var(--code-size, 14px);
}

/*-- ASIDE --*/
d-article aside {
  font-size: var(--aside-size, 12px);
  color: var(--aside-color, rgba(0, 0, 0, 0.6));
}

/*-- FIGURE CAPTIONS --*/
figure .caption,
figure figcaption,
.figure .caption {
  font-size: var(--fig-cap-size, 13px);
  color: var(--fig-cap-color, rgba(0, 0, 0, 0.6));
}

/*-- METADATA --*/
d-byline h3 {
  font-size: var(--heading-size, 0.6rem);
  color: var(--heading-color, rgba(0, 0, 0, 0.5));
}

d-byline {
  font-size: var(--body-size, 0.8rem);
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

d-byline a,
d-article d-byline a {
  color: var(--body-color, rgba(0, 0, 0, 0.8));
}

/*-- TABLE OF CONTENTS --*/
.d-contents nav h3 {
  font-size: var(--heading-size, 18px);
}

.d-contents nav a {
  font-size: var(--contents-size, 13px);
}

/*-- APPENDIX --*/
d-appendix h3 {
  font-size: var(--heading-size, 15px);
  color: var(--heading-color, rgba(0, 0, 0, 0.65));
}

d-appendix {
  font-size: var(--text-size, 0.8em);
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

d-appendix d-footnote-list a.footnote-backlink {
  color: var(--text-color, rgba(0, 0, 0, 0.5));
}

/*-- WEBSITE HEADER + FOOTER --*/
.distill-site-header .title {
  font-size: var(--title-size, 18px);
  font-family: var(--navbar-font), var(--heading-default);
}

.distill-site-header a,
.nav-dropdown .nav-dropbtn {
  font-family: var(--navbar-font), var(--heading-default);
}

.nav-dropdown .nav-dropbtn {
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  font-size: var(--text-size, 15px);
}

.distill-site-header a:hover,
.nav-dropdown:hover .nav-dropbtn {
  color: var(--hover-color, white);
}

.distill-site-header {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer {
  font-size: var(--text-size, 15px);
  color: var(--text-color, rgba(255, 255, 255, 0.8));
  background-color: var(--bkgd-color, #0F2E3D);
}

.distill-site-footer a:hover {
  color: var(--hover-color, white);
}</style>
<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.23/header-attrs.js"></script>
  <link href="../../site_libs/vembedr-0.1.5/css/vembedr.css" rel="stylesheet" />
  <script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<script type="text/javascript" cookie-consent="tracking" async src="https://www.googletagmanager.com/gtag/js?id=G-Q28WX9Y4VS"></script>
<script type="text/javascript" cookie-consent="tracking">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-Q28WX9Y4VS');
</script>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"{dplyr} on Steroids: Handling Data Bases","description":"If you know how to tidy up data within one table, you're already a skilled data scientist! However, as data continues to grow exponentially, taking your skills to the next level involves mastering the art of working with multiple tables within a database, typically done using SQL. In this post, we'll learn three essential techniques using {dplyr} that will allow you to handle databases with ease: merging multiple tables, reducing redundancy through table joins, and effortlessly modifying values within the resulting table.","authors":[{"author":"Yury Zablotski","authorURL":"https://yuzar-blog.netlify.app/","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2023-07-14T00:00:00.000+02:00","citationText":"Zablotski, 2023"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo">
<img src="../../images/my_foto.jpg" alt="Logo"/>
</a>
<a href="../../index.html" class="title">yuzaR-Blog</a>
<input id="distill-search" class="nav-search hidden" type="text" placeholder="Search..."/>
</div>
<div class="nav-right">
<a href="../../about.html">ABOUT</a>
<a href="../../index.html">POSTS</a>
<a href="../../consulting.html">CONSULTING</a>
<a href="https://www.youtube.com/channel/UCcGXGFClRdnrwXsPHi7P4ZA">
<i class="fa fa-youtube-square" aria-hidden="true"></i>
</a>
<a href="https://twitter.com/yuzaR___">
<i class="fa fa-twitter" aria-hidden="true"></i>
</a>
<a href="https://www.linkedin.com/in/dr-yury-zablotski-3765b378/">
<i class="fa fa-linkedin" aria-hidden="true"></i>
</a>
<a href="https://github.com/yuryzablotski/yuzaR-Blog">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="https://koji.to/yuzaR">LEAVE A TIP</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>{dplyr} on Steroids: Handling Data Bases</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
  <a href="../../index.html#category:videos" class="dt-tag">videos</a>
  <a href="../../index.html#category:statistics" class="dt-tag">statistics</a>
  <a href="../../index.html#category:data_wrangling" class="dt-tag">data wrangling</a>
  <a href="../../index.html#category:R_package_reviews" class="dt-tag">R package reviews</a>
</div>
<!--/radix_placeholder_categories-->
<p><p>If you know how to tidy up data within one table, you’re already a skilled data scientist! However, as data continues to grow exponentially, taking your skills to the next level involves mastering the art of working with multiple tables within a database, typically done using SQL. In this post, we’ll learn three essential techniques using {dplyr} that will allow you to handle databases with ease: merging multiple tables, reducing redundancy through table joins, and effortlessly modifying values within the resulting table.</p></p>
</div>

<div class="d-byline">
  Yury Zablotski <a href="https://yuzar-blog.netlify.app/" class="uri">https://yuzar-blog.netlify.app/</a> 
  
<br/>July 14, 2023
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a href="#previous-topics" id="toc-previous-topics">Previous topics</a></li>
<li><a href="#chapter-1-combine-tables" id="toc-chapter-1-combine-tables">Chapter 1: Combine tables</a>
<ul>
<li><a href="#chapter-1-as-4-minutes-video" id="toc-chapter-1-as-4-minutes-video">Chapter 1 as 4 minutes video</a></li>
<li><a href="#bind-columns-and-bind-rows" id="toc-bind-columns-and-bind-rows">Bind columns and bind rows</a></li>
<li><a href="#union-setdiff-and-intersect" id="toc-union-setdiff-and-intersect">Union, setdiff and intersect</a></li>
</ul></li>
<li><a href="#chapter-2-join-tables" id="toc-chapter-2-join-tables">Chapter 2: Join tables</a>
<ul>
<li><a href="#chapter-2-as-10-minutes-video" id="toc-chapter-2-as-10-minutes-video">Chapter 2 as 10 minutes video</a></li>
<li><a href="#mutating-joins" id="toc-mutating-joins">Mutating joins</a>
<ul>
<li><a href="#inner_join" id="toc-inner_join">1. inner_join</a></li>
<li><a href="#left_join" id="toc-left_join">2. left_join</a></li>
<li><a href="#right_join" id="toc-right_join">3. right_join</a></li>
<li><a href="#full_join" id="toc-full_join">4. full_join</a></li>
</ul></li>
<li><a href="#filtering-joins-combine-rows" id="toc-filtering-joins-combine-rows">Filtering joins combine rows</a>
<ul>
<li><a href="#semi_join" id="toc-semi_join">1. semi_join</a></li>
<li><a href="#anti_join" id="toc-anti_join">2. anti_join</a></li>
</ul></li>
</ul></li>
<li><a href="#chapter-3-conditioning" id="toc-chapter-3-conditioning">Chapter 3: Conditioning</a>
<ul>
<li><a href="#chapter-3-as-2-minutes-video" id="toc-chapter-3-as-2-minutes-video">Chapter 3 as 2 minutes video</a></li>
<li><a href="#if-else" id="toc-if-else">If … else …</a></li>
<li><a href="#case-when" id="toc-case-when">Case when</a></li>
</ul></li>
<li><a href="#conclusion-and-whats-next" id="toc-conclusion-and-whats-next">Conclusion and what’s next?</a></li>
<li><a href="#further-readings-and-references" id="toc-further-readings-and-references">Further readings and references</a></li>
</ul>
</nav>
</div>
<h1 id="previous-topics">Previous topics</h1>
<p>To maximize the effect of this post you can have a look at <a href="https://yuzar-blog.netlify.app/posts/2023-01-31-datawrangling1/">{dplyr} for beginners</a>, <a href="https://yuzar-blog.netlify.app/posts/2023-02-07-datawrangling2/">advanced {dplyr}</a> and the review about <a href="https://yuzar-blog.netlify.app/posts/2023-04-18-datawrangling3/">{tidyr} package</a> before.</p>
<p>Consider following tables:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span> <span class='co'># it's the only package you need</span></span>
<span><span class='va'>x</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>A <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1"</span>, <span class='st'>"1"</span>, <span class='st'>"2"</span><span class='op'>)</span>, B <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"a"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>A <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"1"</span>, <span class='st'>"2"</span><span class='op'>)</span>, B <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span><span class='op'>)</span><span class='op'>)</span></span>
<span><span class='va'>z</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>A <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"3"</span>, <span class='st'>"2"</span>, <span class='st'>"1"</span><span class='op'>)</span>, C <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"a"</span>, <span class='st'>"b"</span>, <span class='st'>"c"</span><span class='op'>)</span>, D <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"here"</span>, <span class='st'>"you"</span>, <span class='st'>"go"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-2-1.png" width="624" /></p>
</div>
<h1 id="chapter-1-combine-tables">Chapter 1: Combine tables</h1>
<h2 id="chapter-1-as-4-minutes-video">Chapter 1 as 4 minutes video</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/aL7PeNOvAfw" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
<h2 id="bind-columns-and-bind-rows">Bind columns and bind rows</h2>
<p>To combine several tables into one, we can combine their columns or rows. The <strong>bind_cols</strong> function is the most intuitive way to combine columns.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>z</span><span class='op'>)</span> </span></code></pre>
</div>
<pre><code># A tibble: 3 × 5
  A...1 B     A...3 C     D    
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 1     a     3     a     here 
2 1     b     2     b     you  
3 2     a     1     c     go   </code></pre>
</div>
<p><strong>bind_cols</strong> even renames identical column names, making sure each column is unique. But here’s the catch: the tables can have a different number of columns, but they must have the same number of rows. Otherwise it refuses to work and throws a following error message:</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<pre><code>Error in `bind_cols()`:
! Can&#39;t recycle `..1` (size 3) to match `..2` (size 2).</code></pre>
<p>Looking to stack two tables vertically? Look no further than <strong>bind_rows</strong>! Just remember, these tables should have the same column names. Otherwise, <strong>bind_rows</strong> will generously populate your new dataset with NAs wherever the column names don’t align.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>z</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 6 × 4
  A     B     C     D    
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 1     a     &lt;NA&gt;  &lt;NA&gt; 
2 1     b     &lt;NA&gt;  &lt;NA&gt; 
3 2     a     &lt;NA&gt;  &lt;NA&gt; 
4 3     &lt;NA&gt;  a     here 
5 2     &lt;NA&gt;  b     you  
6 1     &lt;NA&gt;  c     go   </code></pre>
</div>
<p>And that can be a problem. Because when dealing with multiple large tables, it’s easy to lose track of which data belongs to which table. But no worries! The ‘.id’ argument comes to the rescue. It allows you to easily track and identify which table certain values belong to.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>z</span>,  .id <span class='op'>=</span> <span class='st'>"table"</span><span class='op'>)</span> </span></code></pre>
</div>
<pre><code># A tibble: 5 × 5
  table A     B     C     D    
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 1     1     a     &lt;NA&gt;  &lt;NA&gt; 
2 1     2     b     &lt;NA&gt;  &lt;NA&gt; 
3 2     3     &lt;NA&gt;  a     here 
4 2     2     &lt;NA&gt;  b     you  
5 2     1     &lt;NA&gt;  c     go   </code></pre>
</div>
<h2 id="union-setdiff-and-intersect">Union, setdiff and intersect</h2>
<p>However, even though <strong>bind_rows</strong> always delivers, when dealing with sizable tables containing numerous columns, we may end up with an excess of irrelevant columns without even realizing it. That’s why I personally lean towards using the <strong>union_all</strong> command. It accomplishes the same task as <strong>bind_rows</strong>, but if my data isn’t clean, it throws an informative error message, which often saves me from chaos.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-8-1.gif" /><!-- --></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/setops.html'>union_all</a></span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>z</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<pre><code>Error in `union_all()`:
! `x` and `y` are not compatible.
✖ Different number of columns: 2 vs 3.</code></pre>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_rows.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 5 × 2
  A     B    
  &lt;chr&gt; &lt;chr&gt;
1 1     a    
2 1     b    
3 2     a    
4 1     a    
5 2     b    </code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/setops.html'>union_all</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 5 × 2
  A     B    
  &lt;chr&gt; &lt;chr&gt;
1 1     a    
2 1     b    
3 2     a    
4 1     a    
5 2     b    </code></pre>
</div>
<p>But while combining tables via <strong>bind_rows</strong> or <strong>union_all</strong> is useful, it might produce duplicates 👯‍♀, if identical rows appear in both tables. We usually don’t want that! In order to exclude duplicates and keep only one of identical rows while combining tables, we can use <strong>union</strong> command instead of <strong>union_all</strong>.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-11-1.gif" /><!-- --></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>union</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 4 × 2
  A     B    
  &lt;chr&gt; &lt;chr&gt;
1 1     a    
2 1     b    
3 2     a    
4 2     b    </code></pre>
</div>
<p>While the union command excludes duplicates, there are situations where we need to identify the distinct rows in table “x” that do not exist in table “y”, or vice versa. This is where the <strong>setdiff</strong> command comes into play. By specifying two tables, we can easily find all the unique rows that belong to the first specified table.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-13-1.gif" /><!-- --></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># find rows that appear in x but not y</span></span>
<span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 2 × 2
  A     B    
  &lt;chr&gt; &lt;chr&gt;
1 1     b    
2 2     a    </code></pre>
</div>
<p>To obtain unique rows from the “y” table, simply specify “y” as the first table, followed by the “x” table.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-15-1.gif" /><!-- --></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># find rows that appear in y but not x</span></span>
<span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>setdiff</a></span><span class='op'>(</span><span class='va'>y</span>,<span class='va'>x</span><span class='op'>)</span>     </span></code></pre>
</div>
<pre><code># A tibble: 1 × 2
  A     B    
  &lt;chr&gt; &lt;chr&gt;
1 2     b    </code></pre>
</div>
<p>But while <strong>setdiff</strong> completely excludes duplicate rows from a dataset, there are times when we actually want to focus on those duplicates to better understand the repetitive patterns in our data. In order to isolate only the duplicate rows, we can use the <strong>intersect</strong> command.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-17-1.gif" /><!-- --></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://generics.r-lib.org/reference/setops.html'>intersect</a></span><span class='op'>(</span><span class='va'>x</span>,<span class='va'>y</span><span class='op'>)</span>   <span class='co'># find duplicates</span></span></code></pre>
</div>
<pre><code># A tibble: 1 × 2
  A     B    
  &lt;chr&gt; &lt;chr&gt;
1 1     a    </code></pre>
</div>
<h1 id="chapter-2-join-tables">Chapter 2: Join tables</h1>
<p>Combining and merging tables through joins is incredibly useful for data science, as it enables us to unlock valuable insights within complex datasets. While joining tables is usually performed using SQL, this approach comes with numerous limitations. In this chapter, we’ll explore how the intuitive syntax of {dplyr} can revolutionize our ability to join tables, taking our skills to a whole new level of efficiency and flexibility.</p>
<h2 id="chapter-2-as-10-minutes-video">Chapter 2 as 10 minutes video</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/_w6yLNbxabU" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
<p>Being able to handle duplicate rows, as we did in previous chapter, is fantastic! But you might wonder, what if we have duplicate columns? That can occur when we use the <strong>bind_cols</strong> command. For instance, if we mistakenly combine two identical tables, each with 2 columns, the result will have 4 columns. The <strong>bind_cols</strong> command conveniently renames them to avoid confusion, yet it retains all columns. However, as they do not provide any unique information, they are totally redundant!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind_cols.html'>bind_cols</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>x</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code># A tibble: 3 × 4
  A...1 B...2 A...3 B...4
  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
1 1     a     1     a    
2 1     b     1     b    
3 2     a     2     a    </code></pre>
</div>
<p>Thus, we would love <em>R</em> to recognize duplicate columns, to eliminate redundancy by retaining only one column, but also to merge columns that differ in order to make our final model more informative. For example, we might want to combine data about customer purchases with data about customer demographics in order to understand what factors influence customer behavior. And this is precisely the purpose of join commands - to <strong>allow you to combine data from multiple tables</strong>. There are two types of joins: <strong>mutating and filtering</strong>. Let’s begin with the four <strong>mutating</strong> joins.</p>
<h2 id="mutating-joins">Mutating joins</h2>
<h3 id="inner_join">1. inner_join</h3>
<p>The <code>inner_join</code> is the most intuitive. It finds identical columns, keeps just one of them, adds all not matching columns behind it and ignores the rest.</p>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-21-1.gif" /><!-- --></p>
</div>
<p>One useful example of applying <strong>inner_join</strong> is when you have two datasets, let’s say a “Customers” dataset and an “Orders” dataset. Both datasets have a common column, such as “Customer ID,” which serves as a unique identifier for each customer. Such unique identifier is often called <strong>key column</strong>.</p>
<p>By performing an inner_join on the “Customer ID” column, you can merge the two datasets based on matching customer IDs. This operation allows you to create a consolidated dataset that contains information from both datasets but only for customers who have placed orders. In other words, it filters out any customers who have not made any purchases.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Load the dplyr package</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Create the Customer Information table</span></span>
<span><span class='va'>customer_info</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>  CustomerID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"001"</span>, <span class='st'>"002"</span>, <span class='st'>"003"</span><span class='op'>)</span>,</span>
<span>  Name <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"John"</span>, <span class='st'>"Sarah"</span>, <span class='st'>"Michael"</span><span class='op'>)</span>,</span>
<span>  Age <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>25</span>, <span class='fl'>30</span>, <span class='fl'>28</span><span class='op'>)</span>,</span>
<span>  Email <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"john@example.com"</span>, <span class='st'>"sarah@example.com"</span>, <span class='st'>"michael@example.com"</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Create the Purchase History table</span></span>
<span><span class='va'>purchase_history</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>  CustomerID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"001"</span>, <span class='st'>"002"</span>, <span class='st'>"004"</span><span class='op'>)</span>,</span>
<span>  PurchaseDate <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/as.Date.html'>as.Date</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"2022-07-15"</span>, <span class='st'>"2022-06-10"</span>, <span class='st'>"2022-08-20"</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  Product <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"Laptop"</span>, <span class='st'>"Phone"</span>, <span class='st'>"Headphones"</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Perform the inner join</span></span>
<span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span>, by <span class='op'>=</span> <span class='st'>"CustomerID"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID  Name Age             Email PurchaseDate Product
1        001  John  25  john@example.com   2022-07-15  Laptop
2        002 Sarah  30 sarah@example.com   2022-06-10   Phone</code></pre>
</div>
<p>This merged dataset can be valuable for analyzing customer behavior, understanding purchasing patterns, or conducting targeted marketing campaigns to specific customer segments.</p>
<p><strong>But we have to be very careful here</strong>!!! (Arni) The <strong>inner_join</strong> only keeps observations from one table that have perfectly matching values in the other table. If we take our x and y tables, we’ll see that only the first row “1 a” is kept, while “1 b” and “2 a” from table x have no match in table y, and the “2 b” from table y has no match in table x.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># install.packages("gridExtra")</span></span>
<span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>gridExtra</span><span class='op'>)</span></span>
<span><span class='fu'><a href='https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html'>grid.arrange</a></span><span class='op'>(</span></span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/gridExtra/man/tableGrob.html'>tableGrob</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span>,</span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/gridExtra/man/tableGrob.html'>tableGrob</a></span><span class='op'>(</span><span class='va'>y</span><span class='op'>)</span>,</span>
<span>  <span class='fu'><a href='https://rdrr.io/pkg/gridExtra/man/tableGrob.html'>tableGrob</a></span><span class='op'>(</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join</a></span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>y</span><span class='op'>)</span><span class='op'>)</span>,</span>
<span>  ncol <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span></span></code></pre>
</div>
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-23-1.png" width="624" /></p>
</div>
<p>And that’s the most important property of an <strong>inner_join</strong> - <strong>unmatched rows in either table are not included in the result</strong>. This means that generally inner joins are not appropriate in most analyses, because it is <strong>too easy to lose observations</strong>.</p>
<p>If you want to keep all the observations from “x”, or from “y”, or from both tables, we need to apply <code>outer_joins</code>. And there are three of them:</p>
<p><img src="join-venn.png" /></p>
<ul>
<li><code>left_join</code> keeps all observations from the left table</li>
<li><code>right_join</code> keeps all observations from the right table</li>
<li><code>full_join</code> keeps all observations from both tables</li>
</ul>
<p><img src="join-outer.png" /></p>
<h3 id="left_join">2. left_join</h3>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-24-1.gif" /><!-- --></p>
</div>
<p>While the <strong>inner_join</strong> may be the most intuitive, it is the <strong>left_join</strong> that proves to be most commonly employed join in practice and, actually, the most useful for several reasons:</p>
<ul>
<li><p>first, if one table is more important then other, <strong>left joins</strong> allow us to <strong>preserve all the observations from the left table</strong>, even if there are no matches in the right table. This ensures that no important data is lost during merging;</p></li>
<li><p>secondly, the <strong>new data</strong> from the right table that corresponds to the matching observations in the left table <strong>is added</strong></p></li>
<li><p>and finally, <strong>left joins</strong> highlight any discrepancies or mismatches between the tables being joined. When a left join introduces empty values (such as NA) for unmatched observations, it serves as an indicator of data inconsistencies or missing values. Detecting these mismatches early on is crucial for ensuring data integrity and avoiding erroneous conclusions.</p></li>
</ul>
<p>Let’s consider the same example where you have two tables: one containing customer information and another containing purchase history. Here, we want to merge the two tables using a left join to <strong>retain all customer information while incorporating relevant purchase data</strong>. Particularly, customers 001 and 002 had matching records in both tables, so their purchase information was included in to final table. Customer 003, who had no corresponding record in the purchase history table, resulted in NULL values for the purchase-related columns.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Perform the left join</span></span>
<span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span>, by <span class='op'>=</span> <span class='st'>"CustomerID"</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID    Name Age               Email PurchaseDate Product
1        001    John  25    john@example.com   2022-07-15  Laptop
2        002   Sarah  30   sarah@example.com   2022-06-10   Phone
3        003 Michael  28 michael@example.com         &lt;NA&gt;    &lt;NA&gt;</code></pre>
</div>
<p>The “by =” argument in the “left_join” command is crucial!, because it specifies columns that serve as the matching criterion between the two tables being joined. It determines how the rows from each table will be matched and merged.</p>
<p>If the “by =” argument is not provided, the <strong>left_join</strong> command finds identical columns in both tables and uses them all by default. However, that could result in incorrect matches or cause errors during the merging process if columns having the same information named differently. Therefore, it is crucial to specify the correct column(s) to ensure accurate and meaningful results in the merged table.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Create the first table</span></span>
<span><span class='va'>t1</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>  ID <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>,</span>
<span>  Name <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"John"</span>, <span class='st'>"Sarah"</span>, <span class='st'>"Michael"</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span>
<span></span>
<span><span class='co'># Create the second table</span></span>
<span><span class='va'>t2</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span></span>
<span>  Identifier <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>3</span><span class='op'>)</span>,</span>
<span>  Value <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>10</span>, <span class='fl'>20</span>, <span class='fl'>30</span><span class='op'>)</span></span>
<span><span class='op'>)</span></span></code></pre>
</div>
</div>
<p>For example, let’s <strong>left_join</strong> t1 and t2 based on the common ID/Identifier column.</p>
<p>In the first case, when the “by” argument is not specified, the left_join command attempts to automatically match the columns. However, since the columns have different names (ID vs. Identifier), the join does not work, because our tables have no common variables.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># Perform the left join without specifying the "by" argument</span></span>
<span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>t1</span>, <span class='va'>t2</span><span class='op'>)</span></span></code></pre>
</div>
</div>
<pre><code>Error in `left_join()`:
! `by` must be supplied when `x` and `y` have no common
  variables.</code></pre>
<p>But if the correct “by” argument is used, specifying that the ID column from t1 corresponds to the Identifier column from t2, <strong>left_join</strong> works properly.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>t1</span>, <span class='va'>t2</span>, by <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"ID"</span> <span class='op'>=</span> <span class='st'>"Identifier"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  ID    Name Value
1  1    John    10
2  2   Sarah    20
3  3 Michael    30</code></pre>
</div>
<h3 id="right_join">3. right_join</h3>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-30-1.gif" /><!-- --></p>
</div>
<p><strong>Right_join</strong> works similarly to <strong>left_join</strong> by retaining all observations from the right table, “purchase_history” in our case. In fact, in many cases, a <strong>right_join</strong> can be replaced by a <strong>left_join</strong> by reversing the table order. In this way you can achieve the same outcome and retain the same information. So, to be honest, we can ignore <strong>right_join</strong>, but we can’t ignore the <strong>full_join</strong>, and here is why.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>right_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID  Name Age             Email PurchaseDate    Product
1        001  John  25  john@example.com   2022-07-15     Laptop
2        002 Sarah  30 sarah@example.com   2022-06-10      Phone
3        004  &lt;NA&gt;  NA              &lt;NA&gt;   2022-08-20 Headphones</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>purchase_history</span>, <span class='va'>customer_info</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID PurchaseDate    Product  Name Age             Email
1        001   2022-07-15     Laptop  John  25  john@example.com
2        002   2022-06-10      Phone Sarah  30 sarah@example.com
3        004   2022-08-20 Headphones  &lt;NA&gt;  NA              &lt;NA&gt;</code></pre>
</div>
<h3 id="full_join">4. full_join</h3>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-32-1.gif" /><!-- --></p>
</div>
<p><strong>Full_joins</strong> are extremely useful due to their ability to retain all records from both tables, even if there are mismatches or missing values. In this way <strong>full_joins</strong> ensure that no data is lost during the merging process, which is crucial for thorough data analysis and decision-making. Besides, <strong>full_joins</strong> help to identify and investigate inconsistencies and gaps between the datasets, leading to better data quality and more complete data for analysis.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>full_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID    Name Age               Email PurchaseDate    Product
1        001    John  25    john@example.com   2022-07-15     Laptop
2        002   Sarah  30   sarah@example.com   2022-06-10      Phone
3        003 Michael  28 michael@example.com         &lt;NA&gt;       &lt;NA&gt;
4        004    &lt;NA&gt;  NA                &lt;NA&gt;   2022-08-20 Headphones</code></pre>
</div>
<p>Compared to <strong>inner_join</strong> that retains only two matching rows, and compared to <strong>left_join</strong> and <strong>right_join</strong> that retain only three rows, the <strong>full_join</strong> combines all four records from both tables, incorporating <em>NA</em> values in the absence of matches. When not all columns act as “keys”, a <strong>full join seamlessly combines the functionalities of both left and right joins</strong>, offering a comprehensive merging approach.</p>
<p>However, not everything is rosy here! While returning every mismatch can help identify inconsistencies between tables and potentially fill gaps using <a href="https://youtu.be/Akb401i32Oc">advanced machine learning techniques</a>, it can also pose a significant challenge. The sheer volume of “new” observations generated can quickly become overwhelming. In large and complex datasets, which are often the norm, and when both tables contain NAs from the beginning, distinguishing between original NAs and the “new” NAs becomes nearly impossible. This creates a dangerous situation where you might unknowingly proceed with analysis and produce unrealistic results.</p>
<p><strong>Therefore, despite the benefits of joins, be very careful and always double check the output.</strong></p>
<h2 id="filtering-joins-combine-rows">Filtering joins combine rows</h2>
<p>Filtering joins affect only the rows (or observations), not the columns (or variables). In contrast to mutating joins, filtering joins never duplicate rows. There are two filtering joins, semi_joins and anti_joins.</p>
<h3 id="semi_join">1. semi_join</h3>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-34-1.gif" /><!-- --></p>
</div>
<p><strong>Semi_joins</strong> help identify and keep matching records between two tables while retaining only the columns from the first (left) table.</p>
<p><img src="semi_join.png" style="width:49.0%" /> <img src="semi_join_rev.png" style="width:49.0%" /></p>
<p>The <strong>inner_join</strong> might look similar, but it would keep columns from both tables. By keeping only the desired columns from the left table, <strong>semi_joins</strong> help to reduce data complexity and focus on the essential information needed for analysis. In other words they filter and extract relevant records, resulting in a more concise and targeted dataset.</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter-joins.html'>semi_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID  Name Age             Email
1        001  John  25  john@example.com
2        002 Sarah  30 sarah@example.com</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>inner_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID  Name Age             Email PurchaseDate Product
1        001  John  25  john@example.com   2022-07-15  Laptop
2        002 Sarah  30 sarah@example.com   2022-06-10   Phone</code></pre>
</div>
<h3 id="anti_join">2. anti_join</h3>
<div class="layout-chunk" data-layout="l-body">
<p><img src="datawrangling4_files/figure-html5/unnamed-chunk-36-1.gif" /><!-- --></p>
</div>
<p><strong>Anti_joins</strong> are used to exclude records that match between two tables, essentially filtering out the common observations.</p>
<p><img src="anti_join.png" style="width:49.0%" /> <img src="anti_join_rev.png" style="width:49.0%" /></p>
<p>An <strong>anti_join</strong> retains only unmatched rows, making it useful for identifying discrepancies between tables, and if the anti-join returns no results, it’s actually a good thing ;).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter-joins.html'>anti_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID    Name Age               Email
1        003 Michael  28 michael@example.com</code></pre>
</div>
<p>Now that you have your final table in the desired structure, you probably want to explore and visualize your data, aren’t you? If you’re looking for a comprehensive video that will teach you how to efficiently explore all the aspects of the data you see on your screen below right now, then you definitely don’t want to miss out on <a href="https://youtu.be/Swcp0_l65lw">this one</a>.</p>
<p><img src="DEDA.png" /></p>
<h1 id="chapter-3-conditioning">Chapter 3: Conditioning</h1>
<h2 id="chapter-3-as-2-minutes-video">Chapter 3 as 2 minutes video</h2>
<div class="layout-chunk" data-layout="l-body">
<div class="vembedr">
<div>
<iframe src="https://www.youtube.com/embed/Qxs2EB9072g" width="533" height="300" frameborder="0" allowfullscreen="" data-external="1"></iframe>
</div>
</div>
</div>
<p>Having columns and rows in the desired structure is fantastic, and if your table is prepared to embark on the “machine learning wonderland,” it’s even better. However, sometimes we need to change some values within our tables. Here, I would like to introduce two highly valuable techniques that I use everyday.</p>
<h2 id="if-else">If … else …</h2>
<p>The first technique is the <strong>ifelse</strong> command, which enables the creation of a new column based on an existing one (as shown in the first line of code below), or the modification of values within an existing variable (as demonstrated in the second line). When working with NAs in your data, it’s crucial to specify the “na.rm = TRUE” argument to prevent all new observations from becoming NAs (as illustrated in the third line of code).</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>full_join</a></span><span class='op'>(</span><span class='va'>customer_info</span>, <span class='va'>purchase_history</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='va'>CustomerID</span>, <span class='va'>Age</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Age_category <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>Age</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Age</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, <span class='st'>"low"</span>, <span class='st'>"high"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Age <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>Age</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span><span class='op'>(</span><span class='va'>Age</span>, na.rm <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span>, <span class='st'>"low"</span>, <span class='st'>"high"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> </span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>Age_NAs <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span><span class='va'>Age</span> <span class='op'>&lt;</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>Age</span><span class='op'>)</span>, <span class='st'>"low"</span>, <span class='st'>"high"</span><span class='op'>)</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>  CustomerID  Age Age_category Age_NAs
1        001  low          low      NA
2        002 high         high      NA
3        003 high         high      NA
4        004 &lt;NA&gt;         &lt;NA&gt;      NA</code></pre>
</div>
<p>The only drawback of using <strong>ifelse</strong> is that it becomes cumbersome to write multiple <strong>ifelse</strong> statements when dealing with numerous cases, which is where the <strong>case_when</strong> function comes in handy.</p>
<h2 id="case-when">Case when</h2>
<p><img src="case_when-allison.jpeg" /></p>
<p>Let’s consider the “who” dataset 🦉, which is freely available from the World Health Organization Global Tuberculosis (cough 😷) Report. Initially, it may appear messy, but if you’re familiar with my previous tutorials on {dplyr} and {tidyr}, you can easily tidy it up and then transform the age categories from the peculiar “014” format to more comprehensible “0 – 14 years old”. By using the <code>TRUE ~ "bla"</code> clause at the end of the <strong>case_when</strong> command, any categories that do not match the provided ones will be changed to “bla”. If there are occurrences of “bla”, it indicates that further cleaning is required. However, if no “bla” cases are present, as in our example, it signifies that we have successfully accomplished our task. Let’s congratulate ourselves on a job well done! Cheers!</p>
<div class="layout-chunk" data-layout="l-body">
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='va'>d</span> <span class='op'>&lt;-</span> <span class='va'>who</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  </span>
<span>  <span class='co'># I have reviewed {dplyr} and {tidyr} for this piece of code.</span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>cols <span class='op'>=</span> <span class='va'>new_sp_m014</span><span class='op'>:</span><span class='va'>newrel_f65</span>, values_drop_na <span class='op'>=</span> <span class='cn'>T</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/select.html'>select</a></span><span class='op'>(</span><span class='op'>-</span><span class='va'>iso2</span>, <span class='op'>-</span><span class='va'>iso3</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>name <span class='op'>=</span> <span class='fu'>stringr</span><span class='fu'>::</span><span class='fu'><a href='https://stringr.tidyverse.org/reference/str_replace.html'>str_replace</a></span><span class='op'>(</span><span class='va'>name</span>, <span class='st'>"newrel"</span>, <span class='st'>"new_rel"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/separate.html'>separate</a></span><span class='op'>(</span><span class='va'>name</span>, into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"new"</span>, <span class='st'>"type"</span>, <span class='st'>"sexage"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/separate.html'>separate</a></span><span class='op'>(</span><span class='st'>"sexage"</span>, into <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sex"</span>, <span class='st'>"age"</span><span class='op'>)</span>, sep <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span></span>
<span>  </span>
<span>  <span class='co'># Now use case_when to change values</span></span>
<span>  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>age_2 <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/case_when.html'>case_when</a></span><span class='op'>(</span></span>
<span>    <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"014"</span>  <span class='op'>~</span> <span class='st'>"0 – 14 years old"</span>,</span>
<span>    <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"1524"</span> <span class='op'>~</span> <span class='st'>"15 - 24 years old"</span>,</span>
<span>    <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"2534"</span> <span class='op'>~</span> <span class='st'>"25 - 34 years old"</span>,</span>
<span>    <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"3544"</span> <span class='op'>~</span> <span class='st'>"35 - 44 years old"</span>,</span>
<span>    <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"4554"</span> <span class='op'>~</span> <span class='st'>"45 - 54 years old"</span>,</span>
<span>    <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"5564"</span> <span class='op'>~</span> <span class='st'>"55 - 64 years old"</span>,</span>
<span>    <span class='va'>age</span> <span class='op'>==</span> <span class='st'>"65"</span>   <span class='op'>~</span> <span class='st'>"65 or older"</span>,</span>
<span>    <span class='cn'>TRUE</span>          <span class='op'>~</span> <span class='st'>"bla"</span></span>
<span>  <span class='op'>)</span><span class='op'>)</span></span>
<span></span>
<span><span class='va'>d</span></span></code></pre>
</div>
<pre><code># A tibble: 76,046 × 8
   country      year new   type  sex   age   value age_2            
   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;            
 1 Afghanistan  1997 new   sp    m     014       0 0 – 14 years old 
 2 Afghanistan  1997 new   sp    m     1524     10 15 - 24 years old
 3 Afghanistan  1997 new   sp    m     2534      6 25 - 34 years old
 4 Afghanistan  1997 new   sp    m     3544      3 35 - 44 years old
 5 Afghanistan  1997 new   sp    m     4554      5 45 - 54 years old
 6 Afghanistan  1997 new   sp    m     5564      2 55 - 64 years old
 7 Afghanistan  1997 new   sp    m     65        0 65 or older      
 8 Afghanistan  1997 new   sp    f     014       5 0 – 14 years old 
 9 Afghanistan  1997 new   sp    f     1524     38 15 - 24 years old
10 Afghanistan  1997 new   sp    f     2534     36 25 - 34 years old
# ℹ 76,036 more rows</code></pre>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span><span class='co'># janitor is an amazing package I also have reviewed ;)</span></span>
<span><span class='fu'>janitor</span><span class='fu'>::</span><span class='fu'><a href='https://sfirke.github.io/janitor/reference/tabyl.html'>tabyl</a></span><span class='op'>(</span><span class='va'>d</span><span class='op'>$</span><span class='va'>age_2</span><span class='op'>)</span></span></code></pre>
</div>
<pre><code>           d$age_2     n   percent
  0 – 14 years old 10882 0.1430976
 15 - 24 years old 10868 0.1429135
 25 - 34 years old 10850 0.1426768
 35 - 44 years old 10875 0.1430055
 45 - 54 years old 10876 0.1430187
 55 - 64 years old 10851 0.1426900
       65 or older 10844 0.1425979</code></pre>
</div>
<h1 id="conclusion-and-whats-next">Conclusion and what’s next?</h1>
<p>Now, with your final, stunning table in front of you, the natural inclination is to visualize and explore your data, right? To achieve this in the most effective way possible, check out the <a href="https://youtu.be/W3xErD6qIzg">{DataExplorer} package</a> next.</p>
<p><strong>Thank you for reading!</strong></p>
<h1 id="further-readings-and-references">Further readings and references</h1>
<ul>
<li>Most of this article originate from <a href="https://r4ds.hadley.nz/">“R for Data Science”</a> book by Garrett Grolemund and Hadley Wickham.</li>
</ul>
<div class="sourceCode" id="cb26"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<div class="article-footer">
  <p class="social_footer">
    <span class="disqus-comments">
      <i class="fas fa-comments"></i>
      &nbsp;
      <span class="disqus-comment-count" data-disqus-identifier="posts/2023-05-09-datawrangling4/">Comment on this article</span>
    </span>
    <span class="article-sharing">
      Share: &nbsp;
      <a href="https://twitter.com/share?text=%7Bdplyr%7D%20on%20Steroids%3A%20Handling%20Data%20Bases&amp;url=https%3A%2F%2Fyuryzablotski%2FyuzaR-Blog.github.io%2Fposts%2F2023-05-09-datawrangling4%2F" aria-label="share on twitter">
        <i class="fab fa-twitter" aria-hidden="true"></i>
      </a>
      <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fyuryzablotski%2FyuzaR-Blog.github.io%2Fposts%2F2023-05-09-datawrangling4%2F&amp;title=%7Bdplyr%7D%20on%20Steroids%3A%20Handling%20Data%20Bases" aria-label="share on linkedin">
        <i class="fab fa-linkedin" aria-hidden="true"></i>
      </a>
      <a href="https://www.facebook.com/sharer/sharer.php?s=100&amp;p[url]=https%3A%2F%2Fyuryzablotski%2FyuzaR-Blog.github.io%2Fposts%2F2023-05-09-datawrangling4%2F" aria-label="share on facebook">
        <i class="fab fa-facebook" aria-hidden="true"></i>
      </a>
      <a href="https://plus.google.com/share?url=https%3A%2F%2Fyuryzablotski%2FyuzaR-Blog.github.io%2Fposts%2F2023-05-09-datawrangling4%2F" aria-label="share on google-plus">
        <i class="fab fa-google-plus" aria-hidden="true"></i>
      </a>
      <a href="https://pinterest.com/pin/create/link/?url=https%3A%2F%2Fyuryzablotski%2FyuzaR-Blog.github.io%2Fposts%2F2023-05-09-datawrangling4%2F&amp;description=%7Bdplyr%7D%20on%20Steroids%3A%20Handling%20Data%20Bases" aria-label="share on pinterest">
        <i class="fab fa-pinterest" aria-hidden="true"></i>
      </a>
    </span>
  </p>
  <script id="dsq-count-scr" src="https://yuzar-blog.disqus.com/count.js" async></script>
  <div id="disqus_thread" class="hidden"></div>
  <script type="text/javascript" cookie-consent="functionality">
var disqus_config = function () {
  this.page.url = 'https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/';
  this.page.identifier = 'posts/2023-05-09-datawrangling4/';
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = 'https://yuzar-blog.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
</script>
</div>
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>


<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom">
  <h3 id="references">References</h3>
  <div id="references-listing"></div>
  <h3 id="updates-and-corrections">Corrections</h3>
  <p>If you see mistakes or want to suggest changes, please <a href="https://github.com/yuryzablotski/yuzaR-Blog/issues/new">create an issue</a> on the source repository.</p>
  <h3 id="reuse">Reuse</h3>
  <p>Text and figures are licensed under Creative Commons Attribution <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a>. Source code is available at <a href="https://github.com/yuryzablotski/yuzaR-Blog">https://github.com/yuryzablotski/yuzaR-Blog</a>, unless otherwise noted. The figures that have been reused from other sources don't fall under this license and can be recognized by a note in their caption: "Figure from ...".</p>
  <h3 id="citation">Citation</h3>
  <p>For attribution, please cite this work as</p>
  <pre class="citation-appendix short">Zablotski (2023, July 14). yuzaR-Blog: {dplyr} on Steroids: Handling Data Bases. Retrieved from https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/</pre>
  <p>BibTeX citation</p>
  <pre class="citation-appendix long">@misc{zablotski2023{dplyr},
  author = {Zablotski, Yury},
  title = {yuzaR-Blog: {dplyr} on Steroids: Handling Data Bases},
  url = {https://yuryzablotski/yuzaR-Blog.github.io/posts/2023-05-09-datawrangling4/},
  year = {2023}
}</pre>
</div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
